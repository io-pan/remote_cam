package org.iopan.motiondetector;

import org.iopan.motiondetector.tasks.FileMotionDetectionAsyncTask;
import com.facebook.react.bridge.Promise;
import com.facebook.react.bridge.ReactApplicationContext;
import com.facebook.react.bridge.ReactContextBaseJavaModule;
import com.facebook.react.bridge.ReactMethod;
import com.facebook.react.bridge.ReadableMap;

import java.util.Collections;
import java.util.HashMap;
import java.util.Map;

import javax.annotation.Nullable;

public class MotionDetectorModule extends ReactContextBaseJavaModule {
  private static final String TAG = "MotionDetector";
//  private ScopedContext mScopedContext;
private static ReactApplicationContext mScopedContext;

  public MotionDetectorModule(ReactApplicationContext reactContext) {
    super(reactContext);
    mScopedContext = reactContext;
  }

  @Override
  public String getName() {
    return TAG;
  }

  @Nullable
  @Override
  public Map<String, Object> getConstants() {
    return Collections.unmodifiableMap(new HashMap<String, Object>() {
      {
        put("Mode", getMotionDetectorModeConstants());
      }

      private Map<String, Object> getMotionDetectorModeConstants() {
        return Collections.unmodifiableMap(new HashMap<String, Object>() {
          {
            put("fast", 1);
            put("accurate", 1);
          }
        });
      }
    });
  }

  @ReactMethod
  public void detectMotion(ReadableMap options, final Promise promise) {
    new FileMotionDetectionAsyncTask(mScopedContext, options, promise).execute();
  }
}
